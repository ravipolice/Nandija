"use strict";(()=>{var e={};e.id=903,e.ids=[903],e.modules={8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},33480:(e,t,r)=>{e.exports=r(75600)},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},90522:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>u,routeModule:()=>f});var o={};r.r(o),r.d(o,{config:()=>l,default:()=>d});var s=r(33480),n=r(8667),a=r(86435);let i="https://script.google.com/macros/s/AKfycby-7jOc_naI1_XDVzG1qAGvNc9w3tIU4ZwmCFGUUCLdg0_DEJh7oouF8a9iy5E93-p9zg/exec",c=()=>{let e=process.env.APPS_SCRIPT_SECRET_TOKEN||"Ravi@PMD_2025_Secure_Token";return e&&"CHANGE_THIS_IN_PRODUCTION"!==e?e:"Ravi@PMD_2025_Secure_Token"},l={api:{bodyParser:{sizeLimit:"4mb"},externalResolver:!0}};async function d(e,t){if(t.setHeader("Access-Control-Allow-Credentials","true"),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version"),"OPTIONS"===e.method){t.status(200).end();return}if("GET"===e.method)try{let e;let r=c();console.log("\uD83D\uDCC4 Pages API: Fetching documents...");let o=`${i}?action=getDocuments${r&&"CHANGE_THIS_IN_PRODUCTION"!==r?`&token=${encodeURIComponent(r)}`:""}`,s=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},cache:"no-store",redirect:"follow"});if(!s.ok)throw Error(`Apps Script returned ${s.status}`);let n=await s.text();try{e=JSON.parse(n)}catch(e){return console.error("\uD83D\uDCC4 Pages API: JSON parse error",e),t.status(200).json([])}let a=[];return Array.isArray(e)?a=e:e&&"object"==typeof e&&(a=e.data||e.documents||e.items||[],Array.isArray(a)||(a=[e])),t.status(200).json(a)}catch(e){return console.error("\uD83D\uDCC4 Pages API: Error:",e),t.status(200).json([])}if("POST"===e.method)try{let{action:r,title:o,userEmail:s,fileId:n,fileBase64:a,mimeType:l,category:d,description:u,externalUrl:p}=e.body;if("delete"===r||"deleteDocument"===r){let e;if(!o||!n)return t.status(400).json({success:!1,error:"Missing required fields: title, fileId"});let r=c(),a=`${i}?action=delete${r?`&token=${encodeURIComponent(r)}`:""}`,l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete",title:o,fileId:n,userEmail:s||"admin@pmd.com",token:r})});if(!l.ok){let e=await l.text();throw Error(`Apps Script delete failed: ${l.status} ${e}`)}let d=await l.text();try{e=JSON.parse(d)}catch(t){e={success:!0,message:"Deleted (parse fail fallback)"}}return t.status(200).json(e)}if("upload"===r){let e;let r=c(),n=`${i}?action=upload${r?`&token=${encodeURIComponent(r)}`:""}`,f={action:"upload",title:o,userEmail:s||"admin@pmd.com",token:r,category:d,description:u};if(p)f.externalUrl=p;else{if(!a)return t.status(400).json({success:!1,error:"Missing file content or external URL"});f.fileBase64=a,f.mimeType=l}let P=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!P.ok){let e=await P.text();throw Error(`Upload failed: ${P.status} ${e}`)}let A=await P.text();try{e=JSON.parse(A)}catch(t){e={success:!0,message:"Uploaded (parse fail fallback)"}}return t.status(200).json(e)}return t.status(400).json({success:!1,error:"Invalid action"})}catch(e){return console.error("\uD83D\uDCC4 Pages API: POST Error:",e),t.status(500).json({success:!1,error:e.message})}t.status(405).json({error:"Method not allowed"})}let u=(0,a.M)(o,"default"),p=(0,a.M)(o,"config"),f=new s.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/documents",pathname:"/api/documents",bundlePath:"",filename:""},userland:o})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=90522);module.exports=r})();