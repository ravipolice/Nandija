(()=>{var e={};e.id=220,e.ids=[220],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9433:(e,o,t)=>{"use strict";t.r(o),t.d(o,{patchFetch:()=>h,routeModule:()=>g,serverHooks:()=>I,workAsyncStorage:()=>P,workUnitAsyncStorage:()=>D});var s={};t.r(s),t.d(s,{GET:()=>A,OPTIONS:()=>m,POST:()=>R,dynamic:()=>a,runtime:()=>l});var r=t(96559),n=t(48088),c=t(37719),u=t(32190);let a="force-dynamic",l="nodejs",i="https://script.google.com/macros/s/AKfycby-7jOc_naI1_XDVzG1qAGvNc9w3tIU4ZwmCFGUUCLdg0_DEJh7oouF8a9iy5E93-p9zg/exec",p="getDocuments",d=()=>{let e=process.env.APPS_SCRIPT_SECRET_TOKEN||"Ravi@PMD_2025_Secure_Token";return e&&"CHANGE_THIS_IN_PRODUCTION"!==e?e:"Ravi@PMD_2025_Secure_Token"};async function m(){return new u.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}async function A(){try{let e,o,t;let s=d();console.log("\uD83D\uDCC4 Documents API Route: Fetching documents from Google Apps Script..."),console.log("\uD83D\uDCC4 Documents API Route: Token present:",!!s),console.log("\uD83D\uDCC4 Documents API Route: Documents API URL:",i),console.log("\uD83D\uDCC4 Documents API Route: Get action:",p);let r=`${i}?action=${p}${s&&"CHANGE_THIS_IN_PRODUCTION"!==s?`&token=${encodeURIComponent(s)}`:""}`;console.log("\uD83D\uDCC4 Documents API Route: Full URL (token redacted):",r.replace(s||"","[REDACTED]"));try{e=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},cache:"no-store",redirect:"follow"})}catch(e){return console.error("\uD83D\uDCC4 Documents API Route: Fetch failed:",e.message),console.error("\uD83D\uDCC4 Documents API Route: Fetch error stack:",e.stack),u.NextResponse.json({error:`Network error: ${e.message}`,documents:[]},{status:500})}if(console.log("\uD83D\uDCC4 Documents API Route: Response status:",e.status),console.log("\uD83D\uDCC4 Documents API Route: Response ok:",e.ok),console.log("\uD83D\uDCC4 Documents API Route: Response URL (final):",e.url),!e.ok){let o=await e.text().catch(()=>"Could not read error response");return console.error("\uD83D\uDCC4 Documents API Route: Error response status:",e.status),console.error("\uD83D\uDCC4 Documents API Route: Error response text:",o),u.NextResponse.json({error:`Apps Script returned ${e.status}: ${o.substring(0,200)}`,documents:[]},{status:200})}try{o=await e.text(),console.log("\uD83D\uDCC4 Documents API Route: Response text length:",o.length),console.log("\uD83D\uDCC4 Documents API Route: Response text (first 500 chars):",o.substring(0,500))}catch(e){return console.error("\uD83D\uDCC4 Documents API Route: Failed to read response text:",e.message),u.NextResponse.json({error:"Failed to read response from Apps Script",documents:[]},{status:200})}try{t=JSON.parse(o),console.log("\uD83D\uDCC4 Documents API Route: Parsed JSON successfully"),console.log("\uD83D\uDCC4 Documents API Route: Data type:",Array.isArray(t)?"array":typeof t),console.log("\uD83D\uDCC4 Documents API Route: Data length:",Array.isArray(t)?t.length:"not an array"),Array.isArray(t)&&t.length>0&&console.log("\uD83D\uDCC4 Documents API Route: First document sample:",JSON.stringify(t[0],null,2))}catch(e){if(console.error("\uD83D\uDCC4 Documents API Route: JSON parse error:",e?.message),console.error("\uD83D\uDCC4 Documents API Route: Raw response (first 500 chars):",o.substring(0,500)),o.trim().startsWith("<"))return console.error("\uD83D\uDCC4 Documents API Route: Received HTML instead of JSON - Apps Script may require authentication"),u.NextResponse.json({error:"Apps Script returned HTML - check token authentication",documents:[]},{status:200});return u.NextResponse.json([],{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let n=[];return Array.isArray(t)?n=t:t&&"object"==typeof t&&(n=t.data||t.documents||t.items||[],Array.isArray(n)?console.log("\uD83D\uDCC4 Documents API Route: Extracted array from object response"):n=[t]),console.log("\uD83D\uDCC4 Documents API Route: Final documents count:",n.length),n.length>0&&console.log("\uD83D\uDCC4 Documents API Route: Sample document keys:",Object.keys(n[0])),u.NextResponse.json(n,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}catch(e){return console.error("\uD83D\uDCC4 Documents API Route: Unexpected error:",e.message),console.error("\uD83D\uDCC4 Documents API Route: Error stack:",e.stack),u.NextResponse.json({error:e.message||"Failed to fetch documents",documents:[]},{status:200})}}async function R(e){try{let o;let{action:t,title:s,userEmail:r,fileId:n}=await e.json();if(!t||!s)return u.NextResponse.json({success:!1,error:"Missing required fields: action and title"},{status:400});if("deleteDocument"!==t)return u.NextResponse.json({success:!1,error:`Unsupported action: ${t}`},{status:400});if(!n)return u.NextResponse.json({success:!1,error:"Missing required field: fileId"},{status:400});let c=d(),a=`${i}?action=delete${c&&"CHANGE_THIS_IN_PRODUCTION"!==c?`&token=${encodeURIComponent(c)}`:""}`;console.log("\uD83D\uDDD1️ Documents API Route: Deleting document:",s),console.log("\uD83D\uDDD1️ Documents API Route: File ID:",n),console.log("\uD83D\uDDD1️ Documents API Route: User email:",r||"admin@pmd.com"),console.log("\uD83D\uDDD1️ Documents API Route: Target URL:",a.replace(c||"","[REDACTED]"));let l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete",title:s,fileId:n,userEmail:r||"admin@pmd.com",token:c}),cache:"no-store"});if(console.log("\uD83D\uDDD1️ Documents API Route: Response status:",l.status),console.log("\uD83D\uDDD1️ Documents API Route: Response ok:",l.ok),!l.ok){let e=await l.text();throw console.error("\uD83D\uDDD1️ Documents API Route: Delete error response:",e),Error(`HTTP error! status: ${l.status}, body: ${e}`)}try{let e=await l.text();console.log("\uD83D\uDDD1️ Documents API Route: Response text:",e),o=JSON.parse(e)}catch(e){if(200===l.status)o={success:!0,message:"Document deleted successfully"};else throw Error("Failed to parse delete response")}if(console.log("\uD83D\uDDD1️ Documents API Route: Delete response:",o),o.error||!1===o.success)throw Error(o.error||"Delete failed");return u.NextResponse.json({success:!0,message:o.message||"Document deleted successfully",...o},{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}catch(e){return console.error("API Route: Error deleting document:",e),u.NextResponse.json({success:!1,error:e.message||"Failed to delete document"},{status:500})}}let g=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/documents/route",pathname:"/api/documents",filename:"route",bundlePath:"app/api/documents/route"},resolvedPagePath:"C:\\Users\\ravip\\AndroidStudioProjects\\pmd-admin\\app\\api\\documents\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:P,workUnitAsyncStorage:D,serverHooks:I}=g;function h(){return(0,c.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:D})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var o=require("../../../webpack-runtime.js");o.C(e);var t=e=>o(o.s=e),s=o.X(0,[447,580],()=>t(9433));module.exports=s})();