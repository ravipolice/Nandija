(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{252:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(5155),l=r(2115),i=r(1593),s=r(4616),o=r(9869),n=r(8164),d=r(2525),c=r(7213),m=r(2171);function g(){let{user:e}=(0,m.A)(),[t,r]=(0,l.useState)([]),[g,u]=(0,l.useState)(!0),[p,h]=(0,l.useState)(!1),[y,x]=(0,l.useState)("file"),[f,b]=(0,l.useState)("gdrive"),[v,w]=(0,l.useState)({imageUrl:"",title:"",description:"",category:"Gallery"}),[j,N]=(0,l.useState)(null),[k,A]=(0,l.useState)(0),[C,U]=(0,l.useState)(!1),[E,S]=(0,l.useState)(null);(0,l.useEffect)(()=>{F()},[]);let F=async()=>{try{console.log("Loading gallery images...");let e=await (0,i.fb)();console.log("Loaded gallery images:",e),console.log("Number of images:",e.length),e.length>0&&(console.log("First image:",e[0]),console.log("First image URL:",e[0].imageUrl)),r(e),0===e.length&&console.warn("No gallery images found. Check Apps Script API response.")}catch(e){console.error("Error loading images:",e),alert("Failed to load gallery images. Please check the console for details.")}finally{u(!1)}},I=e=>{let t=e.imageUrl||"";return t.includes("storage.googleapis.com")||t.includes("firebasestorage.app")||e.storagePath?"firebase":(t.includes("drive.google.com")||t.includes("lh3.googleusercontent.com")||t.includes("googleusercontent.com"),"gdrive")},P=e=>new Promise((t,r)=>{let a=new FileReader;a.onload=()=>{let e=a.result;t(e.includes(",")?e.split(",")[1]:e)},a.onerror=r,a.readAsDataURL(e)}),L=e=>{var t;return({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",bmp:"image/bmp"})[(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())||""]||"image/jpeg"},T=async t=>{t.preventDefault(),U(!0);try{if("file"===y){if(!j){alert("Please select an image file to upload");return}A(0);let t=setInterval(()=>{A(e=>e>=90?(clearInterval(t),90):e+10)},200);if("firebase"===f){let r=await P(j),a=j.type||L(j.name),l=await fetch("/api/gallery/upload-firebase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:v.title.trim()||j.name.replace(/\.[^/.]+$/,""),fileBase64:r,mimeType:a,category:v.category.trim()||"Gallery",description:v.description.trim()||"",userEmail:(null==e?void 0:e.email)||"admin@pmd.com"})});if(clearInterval(t),A(100),!l.ok){let e=await l.json().catch(()=>({error:"Unknown error"}));throw Error(e.error||"HTTP error! status: ".concat(l.status))}let i=await l.json();if(!i.success)throw Error(i.error||"Upload failed");await F()}else{let r=await P(j),a=j.type||L(j.name),l=await fetch("/api/gallery/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:v.title.trim()||j.name.replace(/\.[^/.]+$/,""),fileBase64:r,mimeType:a,category:v.category.trim()||"Gallery",description:v.description.trim()||"",userEmail:(null==e?void 0:e.email)||"admin@pmd.com"})});if(clearInterval(t),A(100),!l.ok){let e=await l.json().catch(()=>({error:"Unknown error"}));throw Error(e.error||"HTTP error! status: ".concat(l.status))}let i=await l.json();if(!i.success)throw Error(i.error||"Upload failed")}w({imageUrl:"",title:"",description:"",category:"Gallery"}),N(null),A(0),h(!1),await F()}else await (0,i.a1)({imageUrl:v.imageUrl.trim()}),w({imageUrl:"",title:"",description:"",category:"Gallery"}),h(!1),await F()}catch(e){console.error("Error uploading image:",e),alert("Failed to upload image: ".concat((null==e?void 0:e.message)||"Unknown error"))}finally{U(!1),A(0)}},G=async t=>{if(!(null==e?void 0:e.email)){alert("You must be logged in to delete images");return}let r=t.title||t.id||"this image";if(confirm('Are you sure you want to delete "'.concat(r,'"?'))){S(t.id||r);try{await (0,i.XR)(r,e.email),await F()}catch(e){console.error("Error deleting image:",e),alert("Failed to delete image: ".concat((null==e?void 0:e.message)||"Unknown error"))}finally{S(null)}}};return g?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,a.jsx)("div",{className:"text-lg text-gray-600",children:"Loading..."})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Gallery"}),(0,a.jsxs)("button",{onClick:()=>h(!p),className:"flex items-center gap-2 rounded-lg bg-primary-600 px-4 py-2 text-white transition-colors hover:bg-primary-700",children:[(0,a.jsx)(s.A,{className:"h-5 w-5"}),"Add Image"]})]}),p&&(0,a.jsxs)("div",{className:"mb-6 rounded-lg bg-white p-6 shadow-md",children:[(0,a.jsx)("h2",{className:"mb-4 text-xl font-semibold",children:"Add New Image"}),(0,a.jsxs)("div",{className:"mb-4 flex gap-2 border-b border-gray-200",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{x("file"),N(null),w({...v,imageUrl:""})},className:"flex items-center gap-2 px-4 py-2 font-medium transition-colors ".concat("file"===y?"border-b-2 border-primary-600 text-primary-600":"text-gray-500 hover:text-gray-700"),children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),"Upload File"]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{x("url"),N(null)},className:"flex items-center gap-2 px-4 py-2 font-medium transition-colors ".concat("url"===y?"border-b-2 border-primary-600 text-primary-600":"text-gray-500 hover:text-gray-700"),children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),"Image URL"]})]}),(0,a.jsxs)("form",{onSubmit:T,children:["file"===y?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-800 mb-2",children:"Upload To"}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,a.jsxs)("label",{className:"inline-flex items-center gap-2 text-gray-800",children:[(0,a.jsx)("input",{type:"radio",name:"gallery-upload-target",value:"gdrive",checked:"gdrive"===f,onChange:()=>b("gdrive")}),(0,a.jsx)("span",{children:"Google Drive (Apps Script)"})]}),(0,a.jsxs)("label",{className:"inline-flex items-center gap-2 text-gray-800",children:[(0,a.jsx)("input",{type:"radio",name:"gallery-upload-target",value:"firebase",checked:"firebase"===f,onChange:()=>b("firebase")}),(0,a.jsx)("span",{children:"Firebase Storage"})]})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-600",children:"Drive (Apps Script) keeps images in the existing sheet/Drive path. Firebase stores the file in Storage and metadata in Firestore."})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Image File *"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if(!r.type.startsWith("image/")){alert("Please select an image file");return}if(N(r),!v.title){let e=r.name.replace(/\.[^/.]+$/,"");w({...v,title:e})}}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"}),j&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",j.name," (",(j.size/1024/1024).toFixed(2)," MB)"]}),k>0&&k<100&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"h-2 w-full bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-primary-600 transition-all duration-300",style:{width:"".concat(k,"%")}})}),(0,a.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:[k,"% uploaded"]})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title"}),(0,a.jsx)("input",{type:"text",value:v.title,onChange:e=>w({...v,title:e.target.value}),placeholder:"Image title (optional)",className:"block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:v.description,onChange:e=>w({...v,description:e.target.value}),placeholder:"Image description (optional)",rows:3,className:"block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}):(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Image URL *"}),(0,a.jsx)("input",{type:"url",required:!0,value:v.imageUrl,onChange:e=>w({...v,imageUrl:e.target.value}),placeholder:"https://example.com/image.jpg",className:"block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,a.jsxs)("div",{className:"mt-4 flex gap-4",children:[(0,a.jsx)("button",{type:"submit",disabled:C||"file"===y&&!j,className:"rounded-lg bg-primary-600 px-6 py-2 text-white transition-colors hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:C?"file"===y?"Uploading...":"Saving...":"Add Image"}),(0,a.jsx)("button",{type:"button",onClick:()=>{h(!1),w({imageUrl:"",title:"",description:"",category:"Gallery"}),N(null),A(0)},className:"rounded-lg border border-gray-300 px-6 py-2 text-gray-700 transition-colors hover:bg-gray-50",children:"Cancel"})]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:t.map(e=>(0,a.jsx)("div",{className:"group relative overflow-hidden rounded-lg bg-white shadow-md transition-shadow hover:shadow-lg",children:(0,a.jsxs)("div",{className:"aspect-square w-full overflow-hidden bg-gray-100 relative",children:[(0,a.jsx)("img",{src:e.imageUrl||"",alt:e.title||e.id||"Gallery image",className:"h-full w-full object-cover transition-transform group-hover:scale-105",loading:"lazy",referrerPolicy:"no-referrer",onError:t=>{let r=t.currentTarget;if(!r.dataset.failed){var a,l;r.dataset.failed="1";let t=null;if(null===(a=e.imageUrl)||void 0===a?void 0:a.includes("lh3.googleusercontent.com")){let r=e.imageUrl.match(/\/d\/([-\w]{25,})/);r&&(t=r[1])}if(!t&&(null===(l=e.imageUrl)||void 0===l?void 0:l.includes("drive.google.com"))){let r=e.imageUrl.match(/[?&]id=([-\w]{25,})/);r&&(t=r[1])}if(t){if(r.dataset.retried){if(!r.dataset.retried2){r.dataset.retried2="1",r.src="https://drive.google.com/uc?export=view&id=".concat(t);return}}else{r.dataset.retried="1",r.src="https://drive.google.com/thumbnail?id=".concat(t,"&sz=w1000");return}}r.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Crect fill='%23ddd' width='300' height='300'/%3E%3Ctext fill='%23999' font-family='sans-serif' font-size='20' dy='10.5' font-weight='bold' x='50%25' y='50%25' text-anchor='middle'%3EImage%3C/text%3E%3C/svg%3E"}},onLoad:()=>{}}),(()=>{let t=I(e);return(0,a.jsx)("div",{className:"absolute top-2 left-2",children:(0,a.jsx)("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-semibold shadow-lg ".concat("firebase"===t?"bg-blue-600 text-white":"bg-green-600 text-white"),title:"firebase"===t?"Stored in Firebase Storage":"Stored in Google Drive",children:"firebase"===t?"\uD83D\uDD25 Firebase":"\uD83D\uDCC1 Drive"})})})(),(0,a.jsx)("button",{onClick:()=>G(e),disabled:E===(e.id||e.title),className:"absolute top-2 right-2 p-2 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",title:"Delete image",children:(0,a.jsx)(d.A,{className:"h-4 w-4"})}),e.title&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("p",{className:"text-sm font-medium truncate",children:e.title})})]})},e.id))}),0===t.length&&(0,a.jsxs)("div",{className:"rounded-lg bg-white p-12 text-center shadow-md",children:[(0,a.jsx)(c.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsx)("p",{className:"mt-4 text-lg text-gray-500",children:"No images found"})]})]})}},2171:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,AuthProvider:()=>o});var a=r(5155),l=r(2115),i=r(9490);let s=(0,l.createContext)({user:null,loading:!0});function o(e){let{children:t}=e,[r,o]=(0,l.useState)(null),[n,d]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{try{let e=(0,i.Yk)(e=>{o(e),d(!1)});return()=>e()}catch(e){console.error("Error initializing auth:",e),d(!1)}},[]),(0,a.jsx)(s.Provider,{value:{user:r,loading:n},children:t})}let n=()=>(0,l.useContext)(s)},2432:(e,t,r)=>{Promise.resolve().then(r.bind(r,252))},2525:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},4616:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7213:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},8164:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]])},9490:(e,t,r)=>{"use strict";r.d(t,{CI:()=>o,G6:()=>s,Yk:()=>n});var a=r(5404),l=r(1138);let i=new a.HF,s=async()=>{if(!l.j2)throw Error("Firebase Auth not initialized");try{return(await (0,a.df)(l.j2,i)).user}catch(e){throw console.error("Error signing in:",e),e}},o=async()=>{if(!l.j2)throw Error("Firebase Auth not initialized");try{await (0,a.CI)(l.j2)}catch(e){throw console.error("Error signing out:",e),e}},n=e=>l.j2?(0,a.hg)(l.j2,e):(e(null),()=>{})},9869:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},9946:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(2115);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:l=24,strokeWidth:o=2,absoluteStrokeWidth:n,className:d="",children:c,iconNode:m,...g}=e;return(0,a.createElement)("svg",{ref:t,...s,width:l,height:l,stroke:r,strokeWidth:n?24*Number(o)/Number(l):o,className:i("lucide",d),...g},[...m.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),n=(e,t)=>{let r=(0,a.forwardRef)((r,s)=>{let{className:n,...d}=r;return(0,a.createElement)(o,{ref:s,iconNode:t,className:i("lucide-".concat(l(e)),n),...d})});return r.displayName="".concat(e),r}}},e=>{var t=t=>e(e.s=t);e.O(0,[135,563,521,974,441,684,358],()=>t(2432)),_N_E=e.O()}]);